*** Settings ***
Library    SeleniumLibrary
Suite Teardown    Close All Browsers

*** Variables ***
${ONLINE_TEXT}   You're now online!
${OFFLINE_TEXT}  You're offline now!
${PROVIDER_EMAIL}    raghuram.m+02@taskhuman.com
${PROVIDER_PASSWORD}    asd@123Q
${CONSUMER_EMAIL}    raghuram.m+01@taskhuman.com
${CONSUMER_PASSWORD}    asdfgh@12345A

*** Test Cases ***
Open and Position Browsers
    Open and Position Browsers

Login as Provider in Incognito
    Login as Provider in Incognito

Check Provider Online Status
    Check Provider Online Status

Login as Consumer
    Login as Consumer

Goto provider profile and book a session
    Goto provider profile and book a session

Check if booking is listed under provider
    Check if booking is listed under provider
Check if Provider can Release booking
    Release booking

Close browser
    Close Browser

*** Keywords ***

Open and Position Browsers
    Open Browser    https://app-dev.taskhuman.com/login    Chrome    alias=NORM
    Set Window Size    650    1200
    Set Window Position    0    0
    Log    Normal browser size and position set

    Open Browser    https://app-dev.taskhuman.com/login    Chrome    alias=INC    options=add_argument("--incognito")
    Set Window Size    650    1200
    Set Window Position    650    0
    Log    Incognito browser size and position set

Login as Provider in Incognito
    Switch Browser    INC
    Wait Until Element Is Visible    xpath://div[@class='Login-module__signup-text css-0']
    Sleep    5s
    Click Element    xpath://div[@class='Login-module__signup-text css-0']
    Wait Until Element Is Visible    xpath=//input[@name='email']    10s
    Click Element    xpath=//input[@name='email']
    Input Text    xpath=//input[@name='email']    ${PROVIDER_EMAIL}
    Sleep    5s
    Click Element    xpath=//input[@name='password']
    Input Text    xpath=//input[@name='password']    ${PROVIDER_PASSWORD}
    Sleep    5s
    Click Element    xpath://button[@value='submit']
    Sleep    3s

Check Provider Online Status
    ${online_status_present}=    Run Keyword And Return Status    Wait Until Page Contains Element    xpath=//*[text()="${ONLINE_TEXT}"]    10s
    ${offline_status_present}=   Run Keyword And Return Status    Wait Until Page Contains Element    xpath=//*[text()="${OFFLINE_TEXT}"]    10s

    Run Keyword If    ${offline_status_present}    Make Online
    Run Keyword If    ${online_status_present}     Provider is Online

Make Online
    Wait Until Element Is Visible    xpath://button[@id='go_online_now']    10s
    Click Element    xpath://button[@id='go_online_now']
    Sleep    5s
    Click Element    xpath://button[text()='Save']
    Sleep    5s

Provider is Online
    Sleep    5s

Login as Consumer
    Switch Browser    NORM
    Wait Until Element Is Visible    xpath://div[@class='Login-module__signup-text css-0']
    Sleep    5s
    Click Element    xpath://div[@class='Login-module__signup-text css-0']
    Wait Until Element Is Visible    xpath=//input[@name='email']    10s
    Click Element    xpath=//input[@name='email']
    Input Text    xpath=//input[@name='email']    ${CONSUMER_EMAIL}
    Sleep    5s
    Click Element    xpath=//input[@name='password']
    Input Text    xpath=//input[@name='password']    ${CONSUMER_PASSWORD}
    Sleep    5s
    Click Element    xpath://button[@value='submit']
    Sleep    3s

Goto provider profile and book a session
    Go To    https://app-dev.taskhuman.com/profile/5391
    Sleep    5s
    Wait Until Element Is Visible    //div[@class="ActionMenu-module__ActionMenu--Box css-0"][.//img[contains(@src, "66270a2c2207b0047c3d.svg")]]    5s
    Click Element                    //div[@class="ActionMenu-module__ActionMenu--Box css-0"][.//img[contains(@src, "66270a2c2207b0047c3d.svg")]]
    Sleep    5s
    Wait Until Page Contains Element    xpath://*[text()='Select a Topic']    4s
    Sleep    2s
    Wait Until Element Is Visible    xpath=(//span[contains(@class, 'SkillsModalContent-module__SkillsList__Skill')])[1]    10s
    Click Element    xpath=(//span[contains(@class, 'SkillsModalContent-module__SkillsList__Skill')])[1]
    #Wait Until Element Is Visible    xpath=//span[contains(@class, 'BookingForm-module__Topic--Tag') and contains(@class, 'css-1fhfbim') and text()='Yoga']    10s
    #Click Element    xpath=//span[contains(@class, 'BookingForm-module__Topic--Tag') and contains(@class, 'css-1fhfbim') and text()='Yoga']
    Sleep    5s
    Click Element    xpath://*[text()='Next']
    Sleep    5s
    Wait Until Element Is Visible    xpath://*[text()='Today']    3s
    Click Element    xpath://*[text()='Today']
    ${elements}=    Get WebElements    class:BookingForm-module__Time--Tag
    Click Element    ${elements}[0]
    Sleep    5s
    Click Element    xpath://*[text()='Verify Session']
    Sleep    5s
    Wait Until Element Is Visible  xpath://*[text()='Book Session']
    Click Element    xpath://*[text()='Book Session']
    Sleep    10s
    Wait Until Element Is Visible    xpath://*[text()='Got It!']
    Click Element    xpath://*[text()='Got It!']
    Sleep    6s


Check if booking is listed under provider
    Switch Browser    INC
    Sleep    3s
    Page Should Contain Element    xpath=//div[contains(@class, 'AvailabilityCard-module__AvailabilityCard--Appointments')]/div[contains(@class, 'AvailabilityCard-module__AvailabilityCard--AppointmentCard')]
    Sleep    5s

Release booking
    Wait Until Element Is Visible    xpath=//div[contains(@class, 'AvailabilityCard--ActionButton')]    10s
    Click Element                   xpath=//div[contains(@class, 'AvailabilityCard--ActionButton')]
    Wait Until Element Is Visible   xpath=//button[contains(@class, 'ReleaseForm-module__deleteButton')]    10s
    Click Element                   xpath=//button[contains(@class, 'ReleaseForm-module__deleteButton')]


Close Browser
    Close All Browsers
